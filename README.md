# CherryPlayList

Приложение для удобного создания плейлистов для вечеринок.

## Описание проекта

CherryPlayList - это инструмент для создания и управления музыкальными плейлистами с интуитивным интерфейсом перетаскивания. Приложение позволяет быстро составлять последовательности треков из локальной библиотеки и экспортировать готовые плейлисты.

## Основные функции

### 1. Создание последовательности треков

- Добавление треков из памяти (локальной файловой системы)
- Формирование упорядоченной последовательности треков для плейлиста

### 2. Управление через перетаскивание (Drag & Drop)

- Перетаскивание треков внутри плейлиста для изменения порядка
- Перетаскивание треков из обозревателя файлов в плейлист
- Перетаскивание треков между плейлистами и коллекциями
- Копирование треков с помощью Ctrl/Cmd + перетаскивание
- Интуитивный интерфейс для реорганизации треков

### 2.1. Коллекции (Collections)

- **Облегчённые плейлисты** для временного хранения треков
- **Неограниченное количество треков**
- Полная функциональность: выделение, перетаскивание, undo/redo, статистика
- Перетаскивание треков между коллекциями и плейлистами
- Переименование и отображение статистики (количество треков, общая длительность)
- **Автоматическое сохранение** между запусками приложения
- **Экспорт в JSON** формат (аналогично плейлистам)
- Доступны через layout presets: "С коллекциями" и "Коллекции вертикально"

### 3. Демо-плеер треков

- Постоянно доступный плеер в шапке приложения
- Поддерживает популярные форматы, включая FLAC
- Управление: Play/Pause, перемотка по таймлайну, регулировка громкости
- Отображает текущую позицию и общую длительность
- Кнопка «Показать в браузере» переводит FileBrowser к исходному файлу

### 4. Экспорт плейлиста

- **Модальное окно экспорта**: Настройки экспорта доступны при нажатии на кнопку экспорта
  - Выбор папки для экспорта
  - Выбор стратегии экспорта
- **Способ 1**: Копирование треков в отдельную папку с автоматической нумерацией в порядке плейлиста
  - Треки копируются в указанную папку
  - Файлы переименовываются с префиксом номера (например: `01 - Track Name.mp3`, `02 - Track Name.mp3`)
- **Способ 2**: Экспорт в формате AIMP
  - Создание плейлиста в формате AIMP (.m3u8)
  - Использование относительных путей для переносимости плейлиста вместе с папкой музыки
  - Копирование всех треков в подпапку с оригинальными именами

## Технические детали

Подробная техническая документация, включая стек технологий, архитектуру, настройки безопасности и другие технические аспекты, находится в файле [TECHNICAL.md](./TECHNICAL.md).

### Краткая информация о стеке

- **Electron** - платформа для десктопных приложений
- **React** - библиотека для построения UI
- **TypeScript** - типизированный JavaScript

## Архитектура

### Основные компоненты

1. **Обозреватель файлов** - просмотр и выбор треков из локальной библиотеки
2. **Редактор плейлиста** - область для формирования последовательности треков
3. **Коллекции** - облегчённые плейлисты для временного хранения треков (без ограничений)
4. **Система перетаскивания** - универсальный workspace-agnostic механизм drag & drop:
   - **Не зависит от конкретных типов workspace** - работает с любыми track-based workspace через workspace ID
   - Перетаскивание внутри workspace (плейлист, коллекция, будущие типы)
   - Cross-workspace операции (между любыми workspace: плейлист ↔ коллекция, коллекция ↔ коллекция и т.д.)
   - Перетаскивание из файлового браузера
   - Копирование с Ctrl/Cmd + перетаскивание (состояние клавиши сохраняется в `draggedItems.isCopyMode`)
   - Централизованное управление через `dragDropStore` с динамическим поиском stores по workspace ID
5. **Демо-плеер** - воспроизведение выбранного трека без очереди, отображение состояния и управление звуком
6. **Модуль экспорта** - обработка и копирование треков с нумерацией
7. **Кастомизация интерфейса** - настройки внешнего вида приложения:
   - Размеры строк треков (пресеты: маленькие, средние, большие)
   - Отсечки по накоплению времени в плейлисте (с настраиваемым интервалом и возможностью выключения)
   - Унифицированные размеры строк в плейлисте и браузере файлов

Подробная архитектурная документация находится в [TECHNICAL.md](./TECHNICAL.md).

## Установка и запуск

### Требования

- Node.js (LTS версия)
- npm или yarn

### Установка зависимостей

```bash
npm install
```

> Скрипт `npm install` автоматически попытается настроить Husky-хуки. Если проект ещё не инициализирован как git‑репозиторий, шаг будет пропущен без ошибок.

### Запуск в режиме разработки

```bash
npm run electron:dev
```

Этот скрипт запустит Vite dev server и Electron приложение.

### Сборка для production

```bash
npm run build:electron
```

Это скомпилирует Electron код и соберет React приложение.

### Создание дистрибутива

```bash
# Для текущей платформы
npm run dist

# Для конкретной платформы
npm run dist:win    # Windows
npm run dist:mac    # macOS
npm run dist:linux  # Linux
```

**Важно:** Перед сборкой добавьте иконки в папку `build/`:

- `build/icon.ico` - для Windows
- `build/icon.icns` - для macOS
- `build/icon.png` - для Linux

Подробнее см. `BUILD.md` и `build/README.md`

## Качество кода

- `npm run lint` — ESLint + TypeScript + React/Electron плагины
- `npm run stylelint` — правила для CSS/Emotion
- `npm run format` / `npm run format:check` — Prettier
- `npm run check` — объединённый набор проверок (lint + stylelint + format:check)
- Pre-commit hook (при наличии git) автоматически запускает `lint-staged` и прогоняет проверки только для изменённых файлов

Для ручной настройки husky после инициализации git выполните:

```bash
npx husky install
```

## Структура проекта

```
CherryPlayList/
├── electron/          # Electron main process
│   ├── main.ts       # Точка входа Electron
│   ├── preload.ts    # Preload скрипт для безопасного IPC
│   ├── ipc/          # IPC handlers
│   └── utils/        # Утилиты
├── src/              # React приложение
│   ├── app/          # Компоненты уровня приложения
│   │   ├── App.tsx   # Главный компонент приложения
│   │   ├── WorkspaceRenderer.tsx  # Рендерер workspace через реестр
│   │   └── components/  # Компоненты уровня приложения
│   ├── core/         # Базовые типы, интерфейсы, константы
│   │   ├── types/    # Базовые типы (Track, Layout, Workspace)
│   │   ├── interfaces/  # Интерфейсы модулей
│   │   ├── constants/    # Константы
│   │   └── registry/     # Реестр модулей workspace
│   ├── shared/       # Общие компоненты, сервисы, stores
│   │   ├── components/   # Общие компоненты (PlaylistItem, DemoPlayer и т.д.)
│   │   ├── services/     # Сервисы (IPC, File, Export и т.д.)
│   │   ├── stores/      # Zustand stores
│   │   ├── hooks/       # React hooks
│   │   └── utils/        # Утилиты
│   ├── workspaces/   # Модули workspace (изолированные)
│   │   ├── playlist/     # Модуль плейлиста
│   │   │   ├── PlaylistView.tsx
│   │   │   ├── component.tsx
│   │   │   ├── index.ts
│   │   │   └── README.md
│   │   ├── collection/   # Модуль коллекций
│   │   │   ├── CollectionView.tsx
│   │   │   ├── index.ts
│   │   │   └── README.md
│   │   ├── fileBrowser/  # Модуль браузера файлов
│   │   │   ├── FileBrowserView.tsx
│   │   │   ├── index.ts
│   │   │   └── README.md
│   │   └── testZone/     # Тестовые модули
│   │       ├── TestZoneView.tsx
│   │       ├── index.ts
│   │       └── README.md
│   ├── components/   # Компоненты (FileBrowser, SourcesPanel)
│   ├── modules/      # Модули (dragDrop)
│   ├── types/        # Дополнительные типы
│   └── styles/       # Стили
├── public/           # Статические файлы
├── plugins/          # Плагины
```

### Модульная архитектура

Проект использует модульную архитектуру, где каждый workspace является изолированным модулем:

- **`core/`** - базовые типы, интерфейсы и константы, используемые всеми модулями
- **`shared/`** - общие компоненты, сервисы, stores и утилиты, используемые несколькими модулями
- **`workspaces/`** - изолированные модули workspace (playlist, collection, fileBrowser и т.д.)
- **`app/`** - компоненты уровня приложения (App, WorkspaceRenderer, модальные окна)

Каждый модуль workspace:
- Имеет собственную папку в `workspaces/`
- Содержит `index.ts` - регистрирует модуль в `WorkspaceRegistry` при импорте
- Содержит основной компонент (например, `PlaylistView.tsx`, `CollectionView.tsx`)
- Использует только `@core/` и `@shared/` для зависимостей
- Имеет собственную документацию в `README.md`

Подробная документация:

- [FULL_DOCUMENTATION.md](./FULL_DOCUMENTATION.md) - Полная техническая документация
- [TECHNICAL.md](./TECHNICAL.md) - Технические детали и архитектура

## Чеклист функций

- ✅ Создание плейлистов через drag-and-drop
- ✅ Переупорядочивание треков в плейлисте
- ✅ **Коллекции** - облегчённые плейлисты для временного хранения (без ограничений)
- ✅ **Cross-workspace drag-and-drop** - перетаскивание треков между плейлистами и коллекциями
- ✅ **Копирование треков** - Ctrl/Cmd + перетаскивание для копирования вместо перемещения
- ✅ Экспорт плейлиста с нумерацией файлов
- ✅ Экспорт в формате AIMP (M3U8) с относительными путями
- ✅ Сохранение и загрузка плейлистов (JSON)
- ✅ Настройки приложения
- ✅ **Модальное окно экспорта** - настройки экспорта при нажатии на кнопку экспорта
- ✅ **Кастомизация размеров строк** - настраиваемые пресеты размеров треков (маленькие, средние, большие)
- ✅ **Отсечки по времени** - визуальные маркеры накопленного времени в плейлисте (настраиваемый интервал, можно выключить)
- ✅ Система уведомлений
- ✅ Базовый каркас для плагинов
- ✅ Гибкая система layout с поддержкой множественных workspace
- ✅ **Демо-плеер** - воспроизведение треков с кнопками в плейлистах и коллекциях
  - Кнопки воспроизведения в плейлистах и коллекциях
  - Плеер без очереди: в конце трек останавливается
  - Кнопка «Показать в браузере» и индикаторы времени/таймлайн
  - Управление громкостью и перемотка по таймлайну
- ✅ **Отображение длительности треков**
  - Общая длительность в заголовке плейлиста (формат "H:MM:SS" или "M:SS")
  - Длительность каждого трека в отдельной колонке (формат "M:SS")
- ✅ **Выделение и групповое управление треками**
  - Выделение через чекбоксы и клик по элементу
  - Поддержка Ctrl+Click и Shift+Click для множественного выбора
  - Групповое перемещение и удаление выделенных треков
  - Визуальное выделение (изменение цвета заливки и рамка)
